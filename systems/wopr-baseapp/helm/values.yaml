# Copyright 2026 Bob Bomar
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# Minimal - just structure, ApplicationSet provides real values
# Required
app:
  name: "wopr-baseapp"

#Required
image:
  registry: ghcr.io
  repository: "travismontana/wopr/wopr-api"
  tag: latest
  pullPolicy: IfNotPresent

# Optional
# service:
#   type: ClusterIP
#   port: 8989

#pvc:
#  storageClass: ""
#  size: 1Gi
#  accessMode: ReadWriteOnce

#volumes:
#  nfs:
#    server: "a"
#    path: "/a"
#  mountPath: /media

#env:
#  TZ: "America/Chicago"
#  PUID: "1000"
#  PGID: "1000"
env:
    - name: OTEL_TRACES_EXPORTER
      value: otlp
    - name: OTEL_METRICS_EXPORTER
      value: otlp
    - name: OTEL_EXPORTER_OTLP_PROTOCOL
      value: http/protobuf
    - name: OTEL_EXPORTER_OTLP_ENDPOINT
      value: https://otel.monitoring.abode.tailandtraillabs.org

# labels: 
#   app.wopr.io/hasNginx: "true"

#podAnnotations: 
#  prometheus.io/scrape: "true"
#  prometheus.io/port: "4318"
#  prometheus.io/path: "/v1/metrics"

resources:
  requests:
    memory: "256Mi"
    cpu: "100m"
  limits:
    memory: "1Gi"
    cpu: "1000m"

ingress:
  enabled: false
  className: "wopr-traefik"
  annotations: {}
  hosts: 
    - host: chart-example.local
      paths: 
        - path: /
          pathType: Prefix 
  tls:
    - secretName: chart-example-tls
      hosts:
        - chart-example.local

nodeSelector: {}
tolerations: []
affinity: {}

livenessProbe:
  enabled: true  # Default to enabled
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 5
  timeoutSeconds: 3
  failureThreshold: 3
# secrets:
#   # Basic auth (stringData)
# - name: wopr-db-credentials
#    enabled: true
#    type: kubernetes.io/basic-auth
#    username: dbuser
#      password: supersecret
#
#   # TLS cert (data - base64 encoded)
#   - name: wopr-tls
#     enabled: true
#     type: kubernetes.io/tls
#     data:
#       tls.crt: LS0tLS1CRUdJTi...  # base64 cert
#       tls.key: LS0tLS1CRUdJTi...  # base64 key
#
#   # Docker registry (data)
#   - name: registry-creds
#     enabled: true
#     type: kubernetes.io/dockerconfigjson
#     data:
#       .dockerconfigjson: eyJhdXRocyI6e...  # base64 config
#
#   # SSH key (data)
#   - name: git-ssh-key
#     enabled: true
#     type: kubernetes.io/ssh-auth
#     data:
#       ssh-privatekey: LS0tLS1CRUdJTi...  # base64 key
#
#   # Generic opaque (mix both if you want)
#   - name: app-config
#     enabled: true
#     type: Opaque
#     stringData:
#       config.yaml: |
#         some: config
#     data:
#       binary-blob: U29tZSBiaW5hcnk=
securityContext:
  runAsNonRoot: true
  runAsUser: 2222
  runAsGroup: 2222
  fsGroup: 2222
# PersistentVolume array (optional)
# pv:
#   - name: my-nfs-pv
#     enabled: true
#     size: 100Gi
#     accessModes:
#       - ReadWriteMany
#     reclaimPolicy: Retain  # Default: Retain
#     storageClass: ""       # Empty string for no storage class
#     mountOptions:
#       - hard
#       - intr
#       - noatime
#       - vers=3
#     nfs:
#       server: storage.example.com
#       path: /exports/data
#     extraLabels: {}
#
#   - name: my-local-pv
#     enabled: true
#     size: 10Gi
#     accessModes:
#       - ReadWriteOnce
#     hostPath:
#       path: /mnt/data
#       type: DirectoryOrCreate
#     storageClass: local-storage

# PersistentVolumeClaim array (optional)
# pvc:
#   - name: my-app-data
#     enabled: true
#     size: 10Gi
#     accessModes:
#       - ReadWriteOnce
#     storageClass: "rook-cephfs"
#     extraLabels: {}
#
#   - name: my-shared-data
#     enabled: true
#     size: 100Gi
#     accessModes:
#       - ReadWriteMany
#     storageClass: ""        # Empty for binding to PV by selector/label
#     extraLabels:
#       storage-type: nfs

celeryWorker:
  enabled: true
  replicaCount: 1
  
  # Override command/args if needed
  command: ["/home/wopr/.local/bin/celery"]
  args:
    - "-A"
    - "app.celery_app"
    - "worker"
    - "--loglevel=info"
  
  # Worker-specific env vars (merged with global env)
  env: []
  #  - name: CELERY_WORKER_PREFETCH_MULTIPLIER
  #    value: "4"
  
  # Celery inspect ping probe
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 10
    failureThreshold: 3
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi